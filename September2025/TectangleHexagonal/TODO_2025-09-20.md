# TODO — 2025-09-20

## Gesture→Touch Controller bring-up (zero-trust)
- [ ] Draft controller config (`config/controller.json`) with thresholds/knobs
- [ ] Flesh out `controllers/inputAdapter.js` to wrap MediaPipe Tasks stream
- [ ] Implement `controllers/gateFsm.js` (XState O-P-O clutch) with tests
- [ ] Implement `predictors/predictorSidecar.js` and expose PREPARE/CONFIRM events
- [ ] Implement `controllers/touchSynth.js` (touch semantics) with timers & tests
- [ ] Wire `controllers/eventBus.js` for publish/subscribe between tools + telemetry
- [ ] Implement `telemetry/touchTelemetry.js` JSONL writer + export UI hook
- [ ] Create fixtures (`tests/fixtures/*`) with golden JSONL for MP4 replay
- [ ] Smoke: `tests/smoke/touch_controller.golden.smoke.mjs` diff vs golden
- [ ] UI demo harness (Material + WinBox) for manual validation & visual snapshot

## CI / Tooling
- [ ] Add npm script to run unit tests (`node --test tests/unit/**/*.mjs`)
- [ ] Add npm script to run golden replay smoke suite
- [ ] Wire Playwright/Puppeteer snapshot task for visual diffing
- [ ] Enforce bundle size budget for controller build (≤300 KB gz)
- [ ] Upload JSONL + PNG artifacts on CI failure

## Docs & Hand-off
- [ ] Document controller architecture in `docs/controllers/touch-controller.md`
- [ ] Update developer README with zero-trust test workflow
- [ ] Record tuning diary (predictor thresholds, fail cases)

## Snapshot 2025-09-20T19:54:09Z

- [ ] Verify Phase A/B progress from /controllers scaffolding; tick items in TODO_today when Vitest suites pass.
- [ ] Log current predictor assumptions (v_min, delta_safe, epsilon_confirm) into docs/contollers/touch-controller.md before coding.
- [ ] Confirm MP4 placeholder assets exist in /fixtures and reference them from package.json scripts (pnpm test:golden:tap, ...:hold).
- [ ] Ensure 	ests/smoke/touch_controller.golden.smoke.mjs is wired in CI matrix once harness lands.
- [ ] Capture any manual findings from gesture_tasks_offline_v3.html smoke in the tuning diary.

---

## Today Unlocks — O‑P‑O gate → keybridge (HEX_INPUT_BRIDGE)

Goal: Use existing MediaPipe offline demo + recognizer to make pinch/palm behave like a reliable Space key for same‑origin games. Keep it guarded; no regressions in idle smoke.

- [ ] Flag wiring (guarded)
	- Add URL flag `hex_input_bridge=1` to enable the bridge on dev pages.
	- Guard all new listeners/dispatch under `HEX_INPUT_BRIDGE`.

- [ ] Input adapter hookup (existing demos)
	- Use `dev/gesture_tasks_offline_v3.html` stream; read `assets/models/gesture_recognizer.task` outputs.
	- Implement `controllers/inputAdapter.js` to normalize: { t, hand: 'Left'|'Right', gesture: 'Open_Palm'|'Closed_Fist'|'Pinch', conf }.
	- Acceptance: console shows steady Open_Palm at idle; Pinch events appear with conf>0.8.

- [ ] Minimal gate FSM (O‑P‑O clutch)
	- Implement `controllers/gateFsm.js` (XState) with states: idle → pose → locked → idle; cooldown=200ms, hold>=150ms.
	- Events: PREPARE on pose enter (Open_Palm|Pinch), CONFIRM on hold, CANCEL on exit.
	- Tests: `tests/unit/gate_fsm.test.mjs` covers happy path and early cancel.

- [ ] Dino key bridge (same‑origin postMessage)
	- Page: `dev/gesture_tasks_to_dino.html` add right iframe to Dino (same origin).
	- On CONFIRM: `postMessage({ source:'hex', type:'pinch-key', seat:'P1' })`.
	- In iframe: listen and dispatch `KeyboardEvent('keydown'/'keyup', { key:' ' })` to canvas.
	- Acceptance: Pinch → Dino jumps; release → keyup sent; focus retained.

- [ ] One‑Euro defaults + knobs
	- Add `config/controller.json` with `{ oneEuro:{ minCutoff:1.0, beta:0.007 }, cooldownMs:200, holdMs:150 }`.
	- Acceptance: values logged at start; commit to repo.

- [ ] Idle guard stays green
	- Run `tests/smoke/quick_count_hands_idle.smoke.mjs` → PASS (no locks, no pinch events).
	- Add check to `npm run hex:overlay:verify` gate if not already.

- [ ] Golden prep (follow‑up if time permits)
	- Drop placeholder JSONL in `tests/fixtures/` for MP4 replay (two-hands idle + right‑then‑left pinch clip).
	- Stub `tests/smoke/touch_controller.golden.smoke.mjs` diff vs golden to wire later.

- [ ] Docs + traceability
	- Note thresholds (v_min, delta_safe, epsilon_confirm) in `docs/controllers/touch-controller.md`.
	- Link SRL/ADR and Webway `ww-2025-092` at file head; include revert path and TTL.

Acceptance Criteria (today):
- Dino jumps on pinch with HEX_INPUT_BRIDGE on; idle smoke still PASS; unit tests for gate FSM green.

